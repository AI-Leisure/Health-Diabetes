<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ç³–å°¿ç—…å¥åº·ç®¡ç†</title>
<style>
/* ======  æ•´ç«™æ¨£å¼  ====== */
:root{--c1:#1976d2;--r:8px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
*{box-sizing:border-box}
body{margin:0;background:#fafafa;color:#222;display:flex;flex-direction:column;min-height:100vh}
header{background:var(--c1);color:#fff;text-align:center;padding:.8rem}
nav{display:flex;gap:.5rem;justify-content:center;background:#fff;border-bottom:1px solid #ddd}
nav button{flex:1;padding:.6rem;background:none;border:none;font-weight:600;font-size:.9rem;cursor:pointer}
nav button.active{color:var(--c1);border-bottom:3px solid var(--c1)}
main{flex:1;width:95%;max-width:840px;margin:1rem auto}
section{display:none}
section.active{display:block}
form{background:#fff;padding:1rem;border-radius:var(--r);box-shadow:0 1px 4px #0002;display:flex;flex-direction:column;gap:.8rem}
input,select,button{padding:.5rem;font-size:1rem;border-radius:var(--r)}
input,select{border:1px solid #ccc;width:100%}
button{background:var(--c1);color:#fff;border:none;cursor:pointer}
.toggle{display:flex;align-items:center;gap:.4rem;font-size:.9rem}
#listBox .card{background:#fff;padding:.6rem;border-radius:var(--r);box-shadow:0 1px 3px #0002;margin:.5rem 0;font-size:.85rem}
#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}
.day{background:#fff;min-height:80px;position:relative;padding:2px 2px 18px;border-radius:var(--r);font-size:.78rem;box-shadow:0 1px 2px #0001;cursor:pointer;text-align:center;line-height:1.15}
.day>span{position:absolute;top:2px;right:4px;font-size:.7rem;color:#666}
.modal{position:fixed;inset:0;background:#0007;display:flex;align-items:center;justify-content:center;z-index:99}
.modal>div{background:#fff;padding:1rem;border-radius:var(--r);max-width:88%;max-height:90%;overflow:auto}
.warn{color:#d32f2f;text-align:center;font-size:.85rem;margin:.5rem 0}
.hidden{display:none}
.camWrap video{width:100%;border-radius:var(--r)}
.summary{margin-top:4px;text-align:right;font-size:.85rem}
@media(max-width:540px){nav button{font-size:.8rem}}
</style>
</head>
<body>
<header><h2>ç³–å°¿ç—…å¥åº·ç®¡ç†</h2></header>

<nav>
 <button data-tab="rec"  class="active">æ–°å¢ç´€éŒ„</button>
 <button data-tab="list">åˆ—è¡¨</button>
 <button data-tab="cal">æœˆæ›†</button>
 <button data-tab="sum">çµ±è¨ˆ</button>
 <button data-tab="graph">åœ–è¡¨</button>
 <button data-tab="rep">é©—èº«å ±å‘Š</button>
</nav>

<main>
<!-- ========= æ–°å¢ç´€éŒ„ ========= -->
<section id="rec" class="active">
<form id="recForm">
 <div class="toggle"><label>é¡¯ç¤ºå€‹è³‡ <input type="checkbox" id="showPI" checked></label></div>
 <div id="piArea">
  <label>å§“å <input id="name"></label>
  <label>å¹´é½¡ <input id="age" type="number" min="0"></label>
 </div>

 <label>æ—¥æœŸ <input id="date" type="date"></label>
 <label>é¤æ¬¡
  <select id="period"><option>æ—©é¤</option><option>åˆé¤</option><option>æ™šé¤</option></select>
 </label>

 <label>è¡€ç³– (mmol/Lï¼Œå¯ç•™ç©º) <input id="bg" type="number" step="0.1" min="0"></label>

 <fieldset style="border:1px solid #ccc;border-radius:var(--r);padding:.8rem">
  <legend>é£Ÿç‰©ç›¸ç‰‡ (åªå­˜ç›¸ç‰‡èˆ‡ä¼°ç®—ç³–åˆ†)</legend>
  <div style="display:flex;gap:.6rem;margin-bottom:.5rem">
   <input id="photo" type="file" accept="image/*">
   <button type="button" id="camBtn">ğŸ“· å³æ™‚æ‹ç…§</button>
  </div>
  <div id="photoPrev" class="hidden">
    <img id="prevImg" style="width:100%;max-height:150px;object-fit:cover;border-radius:var(--r)">
    <p>ä¼°ç®—ç³–åˆ†ï¼š<span id="foodSugar"></span> mmol/L</p>
  </div>
 </fieldset>

 <button>å„²å­˜ç´€éŒ„</button>
</form>
</section>

<!-- ========= åˆ—è¡¨ ========= -->
<section id="list"><div id="listBox"></div></section>

<!-- ========= æœˆæ›† ========= -->
<section id="cal">
  <div style="display:flex;justify-content:space-between;align-items:center;margin:.4rem 0">
    <button id="prevM">&lt;</button><h3 id="calTitle" style="margin:0"></h3><button id="nextM">&gt;</button>
  </div>
  <div id="calendar"></div>
  <div id="monthSugar" class="summary"></div>
</section>

<!-- ========= çµ±è¨ˆ ========= -->
<section id="sum">
 <h3>æœ¬æœˆè¡€ç³–çµ±è¨ˆ</h3>
 <table style="width:100%;border-collapse:collapse;font-size:.9rem">
  <thead><tr><th>é¤æ¬¡</th><th>å¹³å‡ mmol/L</th></tr></thead>
  <tbody id="sumBody"></tbody>
 </table>
 <canvas id="sumChart" style="max-width:100%;margin-top:.8rem"></canvas>
</section>

<!-- ========= åœ–è¡¨ ========= -->
<section id="graph">
 <button id="drawGraph" style="width:100%;margin-bottom:.8rem">ğŸ”„ ç”¢ç”ŸæŠ˜ç·šåœ– (å…¨éƒ¨æ—¥æœŸ)</button>
 <canvas id="graphCanvas" style="max-width:100%"></canvas>
</section>

<!-- ========= é©—èº«å ±å‘Š ========= -->
<section id="rep">
 <h4>ä¸Šå‚³é©—èº«å ±å‘Šæª” (jpg/png/pdf)</h4>
 <input id="repFile" type="file" accept="image/*,.pdf" multiple>
 <button id="analyzeBtn" style="width:100%;margin:.8rem 0">OCR è§£æä¸¦åŠ å…¥è³‡æ–™</button>
 <canvas id="chart" style="max-width:100%;margin-top:1rem"></canvas>
 <p id="repMsg" class="warn hidden"></p>
</section>
</main>

<div id="modal" class="modal hidden"><div id="modalContent"></div></div>

<!-- =====  ç¬¬ä¸‰æ–¹åœ–è¡¨å‡½å¼ ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
/* ---------- å·¥å…· ---------- */
const $=q=>document.querySelector(q), $$=q=>document.querySelectorAll(q), pad=n=>n.toString().padStart(2,'0');
/* ---------- å„²å­˜ ---------- */
function lsOK(){try{localStorage.setItem('t','1');localStorage.removeItem('t');return true;}catch{return false}}
const persist=lsOK(),mem={},store={get:k=>persist?JSON.parse(localStorage.getItem(k)||'null'):mem[k]??null,
                                    set:(k,v)=>{persist?localStorage.setItem(k,JSON.stringify(v)):mem[k]=v;}};
/* ---------- ç‹€æ…‹ ---------- */
let recArr=store.get('records')||[],repArr=store.get('reports')||[];
let curMonth=new Date();let photoData=null,foodSugar=null;
/* ---------- é è¨­æ—¥æœŸ ---------- */
$('#date').value=new Date().toISOString().slice(0,10);
/* ---------- å€‹è³‡é–‹é—œ ---------- */
$('#showPI').onchange=e=>$('#piArea').style.display=e.target.checked?'block':'none';
/* ---------- æ‹ç…§ ---------- */
$('#camBtn').onclick=async()=>{ â€¦ /* çœç•¥è¨»è§£ï¼Œç¨‹å¼å¦‚å‰ */ };
/* ---------- åœ–ç‰‡ä¸Šå‚³ ---------- */
$('#photo').onchange=e=>{ â€¦ };
function calcSugar(url){ â€¦ }
/* ---------- å„²å­˜ç´€éŒ„ ---------- */
$('#recForm').onsubmit=e=>{ â€¦ };
/* ---------- åˆ—è¡¨ ---------- */
function renderList(){ â€¦ }
/* ---------- æœˆæ›† & è©³ç´° ---------- */
$('#prevM').onclick=()=>{curMonth.setMonth(curMonth.getMonth()-1);renderCal();}
$('#nextM').onclick=()=>{curMonth.setMonth(curMonth.getMonth()+1);renderCal();}
function renderCal(){ â€¦ }
function showDetail(d){ â€¦ }
$('#modal').onclick=e=>e.target.id==='modal'&&$('#modal').classList.add('hidden');
/* ---------- æœ¬æœˆçµ±è¨ˆ ---------- */
let sumChart=null;function renderSummary(){ â€¦ }
/* ---------- å…¨æœŸé–“åœ–è¡¨ ---------- */
let graphChart=null;$('#drawGraph').onclick=()=>{ â€¦ };
/* ---------- é©—èº«å ±å‘Š OCR + Chart ---------- */
async function loadTess(){if(window.Tesseract)return;await import('https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js');}
function readFile(f){ â€¦ }
function parseReport(t){ â€¦ }
$('#analyzeBtn').onclick=async()=>{ â€¦ };
let repChart=null;function drawReportChart(){ â€¦ }
/* ---------- åˆ†é åˆ‡æ› ---------- */
$$('nav button').forEach(btn=>btn.onclick=()=>{ â€¦ });
/* ---------- åˆå§‹è¼‰å…¥ ---------- */
renderCal();
</script>
</body>
</html>
